<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - worker - offscreen canvas</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				background-color: #fff;
				color: #444;
			}

			a {
				color: #08f;
			}

			canvas {
				display: inline-block;
			}

			#message {
				color: #ff0000;
				display: none;
			}

			#message > a {
				color: #ff0000;
			}

			#container {
				position: absolute;
				top: 50px;
				bottom: 70px;
				width: 100%;
			}

			#ui {
				position: absolute;
				bottom: 20px;
				width: 100%;
				text-align: center;
			}

			#button {
				border: 0;
				padding: 4px 6px;
				background: #dddddd;
				outline: none;
			}
		</style>
	</head>
	<body>
		<div id="info">
			<a href="https://threejs.org" target="_blank" rel="noopener noreferrer">three.js</a> - offscreen canvas (<a href="https://developer.mozilla.org/en-US/docs/Web/API/OffscreenCanvas" target="_blank" rel="noopener noreferrer">about</a>)<br/>
			<p id="message">Your browser does not support OffscreenCanvas. Check the browser support <a href="https://caniuse.com/#feat=offscreencanvas" target="_blank" rel="noopener noreferrer">here</a></p>
		</div>

		<div id="container">
			<canvas id="canvas1" style="width: 20%; height: 20%; border:1px solid red ;"></canvas><canvas id="canvas2" style="width: 20%; height: 20%;border:1px solid red ;"></canvas><canvas id="canvas3" style="width: 20%; height: 20%;border:1px solid red ;"></canvas><canvas id="canvas4" style="width: 20%; height: 20%;border:1px solid red ;"></canvas>
            <canvas id="canvas5" style="width: 20%; height: 20%;border:1px solid red ;"></canvas><canvas id="canvas6" style="width: 20%; height: 20%;border:1px solid red ;"></canvas><canvas id="canvas7" style="width: 20%; height: 20%;border:1px solid red ;"></canvas><canvas id="canvas8" style="width: 20%; height: 20%;border:1px solid red ;"></canvas>
            <canvas id="canvas9" style="width: 20%; height: 20%;border:1px solid red ;"></canvas><canvas id="canvas10" style="width: 20%; height: 20%;border:1px solid red ;"></canvas><canvas id="canvas11" style="width: 20%; height: 20%;border:1px solid red ;"></canvas><canvas id="canvas12" style="width: 20%; height: 20%;border:1px solid red ;"></canvas>
            <canvas id="canvas13" style="width: 20%; height: 20%;border:1px solid red ;"></canvas><canvas id="canvas14" style="width: 20%; height: 20%;border:1px solid red ;"></canvas><canvas id="canvas15" style="width: 20%; height: 20%;border:1px solid red ;"></canvas><canvas id="canvas16" style="width: 20%; height: 20%;border:1px solid red ;"></canvas>
		</div>
		<script type="importmap">
			{
				"imports": {
					"three": "./node_modules/three/build/three.module.js",
					"GLTFLoader":"./node_modules/three/examples/jsm/loaders/GLTFLoader.js"
				}
			}
		</script> 

	

		<script type="module">
		
			import init from './src/myscene.js';

			// onscreen
            let totalcnt=8192;
            let canvascnt=8;

            let canvases=[]
            for(let i=0;i<canvascnt;i++){
                let canvasName = 'canvas'+(i+1);
                let canvas = document.getElementById( canvasName);
                const width = canvas.clientWidth;
                const height = canvas.clientHeight;
                const pixelRatio = window.devicePixelRatio;
                if(i==0){
                   
                    init( canvas, width, height, pixelRatio, './' ,totalcnt/canvascnt);
                } else{
                    if ('transferControlToOffscreen' in canvas) {
                    const offscreen = canvas.transferControlToOffscreen();
                    const worker = new Worker( './src/myoffscreen.js', { type: 'module' } );
                    worker.postMessage( {
                        drawingSurface: offscreen,
                        width: canvas2.clientWidth,
                        height: canvas2.clientHeight,
                        pixelRatio: window.devicePixelRatio,
                        path: '../../',
                        cnt:totalcnt/canvascnt
                    }, [ offscreen ] );

                    } else {

                        document.getElementById( 'message' ).style.display = 'block';

                    }
                }
               
            }
		

		</script>
	</body>
</html>